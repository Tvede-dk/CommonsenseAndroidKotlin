class MultiDirRes implements Plugin<Project> {

    @Override
    void apply(Project project) {

        if (project.pluginManager.hasPlugin("com.android.application")) {
            applyMultiSourceDir(project)
        } else if (project.pluginManager.hasPlugin("com.android.library")) {
            applyMultiSourceDir(project)
        } else {
            println("Not android based project, thus disabling plugin.")
        }
    }

    def resDirs = [
            "anims",
            "colors",
            "drawables",
            "mipmap",
            "drawables-hdpi",
            "drawables-mdpi",
            "drawables-xhdpi",
            "drawables-xxhdpi",
            "layout",
            "values",
    ]

    void applyMultiSourceDir(Project project) {
        project.afterEvaluate {
            println "Multi res dir enabled for $project.name"
            project.android.sourceSets.each {
                def rootResDir = it.res.srcDirs[0]

                def srcDirs = resDirs.collect {
                    getSubDirs(it, rootResDir)
                }
                it.res.srcDirs = [srcDirs, rootResDir]
            }
        }

    }
    def getSubDirs = { dirName, rootResDir ->

        def resDir = new File(rootResDir, dirName)
        def subLayoutDirs = []
        if (resDir.exists()) {

            resDir.eachDir {
                subLayoutDirs.add it
                println "\t - adding dir $it to category $dirName"
            }
        }
        return subLayoutDirs
    }
}

apply plugin: MultiDirRes

